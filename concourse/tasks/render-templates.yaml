platform: linux

image_resource:
  type: docker-image
  source:
    repository: gcr.io/compute-image-tools/jsonnet-go
    tag: latest

inputs:
- name: guest-test-infra

outputs:
- name: rendered

run:
  path: sh
  args:
  - -exc
  - |
    for template in guest-test-infra/((config_dir))/*.jsonnet; do
      base=$(basename "$template")
      jsonnet $template > rendered/${base//.jsonnet}.json
    done
